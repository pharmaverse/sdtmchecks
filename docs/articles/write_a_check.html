<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Writing a New Check • sdtmchecks</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Writing a New Check">
<meta property="og:description" content="sdtmchecks">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sdtmchecks</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/sdtmchecks.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/write_a_check.html">Writing a New Check</a>
    </li>
    <li>
      <a href="../articles/search_checks.html">Search Data Check Functions</a>
    </li>
    <li>
      <a href="../articles/faqs.html">Frequently Asked Questions (FAQs)</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Releases</li>
    <li>
      <a href="https://pharmaverse.github.io/sdtmchecks/news/index.html#sdtmchecks-016-bubble-and-squeak">sdtmchecks 0.1.6</a>
    </li>
    <li>
      <a href="https://pharmaverse.github.io/sdtmchecks/news/index.html#sdtmchecks-015-hunter-pi">sdtmchecks 0.1.5</a>
    </li>
    <li>
      <a href="https://pharmaverse.github.io/sdtmchecks/news/index.html#sdtmchecks-014-very-cool-nickname">sdtmchecks 0.1.2-0.1.4</a>
    </li>
    <li>
      <a href="https://pharmaverse.github.io/sdtmchecks/news/index.html#sdtmchecks-011-open-up">sdtmchecks 0.1.1</a>
    </li>
    <li class="divider">
    </li>
<li>
      <a href="../news/index.html">Changelog</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pharmaverse/sdtmchecks" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Writing a New Check</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pharmaverse/sdtmchecks/blob/HEAD/vignettes/write_a_check.Rmd" class="external-link"><code>vignettes/write_a_check.Rmd</code></a></small>
      <div class="hidden name"><code>write_a_check.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>Clinical trial datasets can contain a million different types of incorrect data. This package does not intend to comprehensively cover all scenarios in which data may be wrong. Instead the data checks in this package are intended to be <strong>generalizable</strong>, <strong>actionable</strong>, and <strong>meaningful for analysis</strong>. For example many clinical trials contain the <code>CO</code> domain, however the <code>sdtmchecks</code> package does not have any functionality around this domain as it is usually not meaningful for analysis.</p>
</div>
<div class="section level2">
<h2 id="working-in-github">Working in GitHub<a class="anchor" aria-label="anchor" href="#working-in-github"></a>
</h2>
<p>The <code>main</code> branch contains the latest released version and should not be used for development.</p>
<p>The <code>devel</code> branch is the default branch and contains the latest development version of the package. To start contributing, please make a feature branch off of <code>devel</code>. When your code is ready to be incorporated please open a pull request that another person will review prior to merging the update into <code>devel</code>. If you do not have write access to the repository, please work off of a forked repo and <a href="https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-a-pull-request-from-a-fork" class="external-link">open a pull request from the fork</a>.</p>
</div>
<div class="section level2">
<h2 id="existing-checks">Existing Checks<a class="anchor" aria-label="anchor" href="#existing-checks"></a>
</h2>
<p>The <code>sdtmchecksmeta</code> dataset lists existing checks and contains helpful additional information</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Just type this in</span></span>
<span><span class="va">sdtmchecksmeta</span></span></code></pre></div>
<pre><code><span><span class="co">## # A tibble: 10 x 4</span></span>
<span><span class="co">##    check             domains title         description                          </span></span>
<span><span class="co">##    &lt;chr&gt;             &lt;chr&gt;   &lt;chr&gt;         &lt;chr&gt;                                </span></span>
<span><span class="co">##  1 check_ae_aeacn_d… ae, ds  COVID AE trt… Check patient(s) with COVID-related …</span></span>
<span><span class="co">##  2 check_ae_aeacnoth ae      AE AEACNOTH … Check for null AEACNOT[1/2] when AEA…</span></span>
<span><span class="co">##  3 check_ae_aeacnot… ae, ds  AE AEACNOTx … Check for DS record indicating study…</span></span>
<span><span class="co">##  4 check_ae_aeacnot… ae, ds  COVID AE stu… Check patient(s) with COVID-related …</span></span>
<span><span class="co">##  5 check_ae_aedecod  ae      AE Missing PT Check for AEs with missing Dictionar…</span></span>
<span><span class="co">##  6 check_ae_aedthdt… ae      AE Death Dat… Check for AEs with death date but AE…</span></span>
<span><span class="co">##  7 check_ae_aedthdt… ae, ds  DS Death Dat… Check that patients with a DS record…</span></span>
<span><span class="co">##  8 check_ae_aelat    ae      AE AELAT Mis… OPHTHALMOLOGY: Check for missing lat…</span></span>
<span><span class="co">##  9 check_ae_aeout    ae      AE Death Out… Check for AE consistency between dea…</span></span>
<span><span class="co">## 10 check_ae_aeout_a… ae      Fatal AE Res… Check for fatal AEs with inconsisten…</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="good-practices">Good Practices<a class="anchor" aria-label="anchor" href="#good-practices"></a>
</h2>
<ul>
<li>
<p>When writing a new check, the function name should start with the word ‘check’ and contain key dataset information plus a 1-2 word description, i.e. <code>check_[dataset1]_..._[datasetN]_[brief description]</code>. For example:</p>
<ul>
<li><code>check_dm_race &lt;- function(DM){...}</code></li>
<li><code>check_dv_ae_covid &lt;- function(DV, AE){...}</code></li>
</ul>
</li>
<li><p>Each function should at minimum take the datasets being investigated as parameters, e.g. <code>check_ae_aedecod &lt;- function(AE){...}</code></p></li>
<li><p>Each function should start with a check for required variables. The following internal functions may be helpful for this: <code>%lacks_all%</code>, <code>%lacks_any%</code>, <code>%has_all%</code>, or <code>%has_any%</code>.</p></li>
<li><p>All checks should use the internal <code><a href="../reference/pass.html">pass()</a></code> and <code><a href="../reference/fail.html">fail()</a></code> functions to return either <code>TRUE</code> or <code>FALSE</code> depending on check results. These functions enable attributes to be attached to the boolean result, e.g. a message or a listing of flagged records.</p></li>
<li><p><code>sdtmchecks</code> intentionally attempts to minimize external dependencies. This is something to keep in mind when developing a new check. Currently the only dependencies within data check functions are <code>dplyr</code> and <code>tidyselect</code>.</p></li>
<li><p>Include examples with <strong>dummied</strong> dataframes in the header that test the logic, assumptions, and robustness of the data check function.</p></li>
<li><p>Even better, include unit tests to accompany the code.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="example-check">Example Check<a class="anchor" aria-label="anchor" href="#example-check"></a>
</h2>
<p>If you are writing your first check it might be helpful to start by editing an existing one, for example the one below:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Example check</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param DM </span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return boolean</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' \dontrun{</span></span>
<span><span class="co">#'    check_dm_age_missing(DM)</span></span>
<span><span class="co">#'   }</span></span>
<span><span class="co">#'</span></span>
<span></span>
<span><span class="va">check_dm_age_missing</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">DM</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">###First check that required variables exist and return a message if they don't</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">DM</span> <span class="op"><a href="../reference/grapes-lacks_any-grapes.html">%lacks_any%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>,<span class="st">"AGE"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="fu"><a href="../reference/fail.html">fail</a></span><span class="op">(</span><span class="fu"><a href="../reference/lacks_msg.html">lacks_msg</a></span><span class="op">(</span><span class="va">DM</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>,<span class="st">"AGE"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span>    <span class="co">### Subset DM to only records with missing AGE</span></span>
<span>    <span class="va">mydf_0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">DM</span>, <span class="fu"><a href="../reference/is_sas_na.html">is_sas_na</a></span><span class="op">(</span><span class="va">DM</span><span class="op">$</span><span class="va">AGE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>,<span class="st">"AGE"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="co">### Subset DM to only records with AGE&lt;18</span></span>
<span>    <span class="va">mydf_1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">DM</span>, <span class="op">!</span><span class="fu"><a href="../reference/is_sas_na.html">is_sas_na</a></span><span class="op">(</span><span class="va">DM</span><span class="op">$</span><span class="va">AGE</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">DM</span><span class="op">$</span><span class="va">AGE</span><span class="op">&lt;</span><span class="fl">18</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>,<span class="st">"AGE"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="co">### Subset DM to only records with AGE&gt;90</span></span>
<span>    <span class="va">mydf_2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">DM</span>, <span class="op">!</span><span class="fu"><a href="../reference/is_sas_na.html">is_sas_na</a></span><span class="op">(</span><span class="va">DM</span><span class="op">$</span><span class="va">AGE</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">DM</span><span class="op">$</span><span class="va">AGE</span><span class="op">&gt;=</span><span class="fl">90</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"USUBJID"</span>,<span class="st">"AGE"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="co">### Combine records with abnormal AGE</span></span>
<span>    <span class="va">mydf3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">mydf_0</span>, <span class="va">mydf_1</span>, <span class="va">mydf_2</span><span class="op">)</span></span>
<span>    <span class="va">mydf</span> <span class="op">=</span> <span class="va">mydf3</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">mydf3</span><span class="op">$</span><span class="va">USUBJID</span><span class="op">)</span>,<span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">mydf</span><span class="op">)</span><span class="op">=</span><span class="cn">NULL</span></span>
<span>    <span class="co">###Print to report</span></span>
<span>    <span class="co">### Return message if no records with missing AGE, AGE&lt;18 or AGE&gt;90</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mydf</span><span class="op">)</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="fu"><a href="../reference/pass.html">pass</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="co">### Return subset dataframe if there are records with missing AGE, AGE&lt;18 or AGE&gt;90</span></span>
<span>    <span class="op">}</span><span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mydf</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="fu"><a href="../reference/fail.html">fail</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"DM has "</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">mydf</span><span class="op">$</span><span class="va">USUBJID</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   <span class="st">" patient(s) with suspicious age value(s). "</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>,</span>
<span>             <span class="va">mydf</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="additional-considerations">Additional Considerations<a class="anchor" aria-label="anchor" href="#additional-considerations"></a>
</h2>
<ul>
<li>Can any variables be considered optional rather than required?</li>
<li>Is enough information returned that identify the issue source? For example, returning only a patient ID may not enable easy identification of the problem records.</li>
<li>Is this check impactful for analysis? Checking little used aspects of SDTM data can cause unnecessary work.</li>
<li>Will this check be meaningful across many trials or is specific to just a small number of trials?</li>
<li>Are false positives being minimized? The check will not be useful if end users need to sift through a large number of incorrectly flagged records to find a one or two correctly flagged records.</li>
<li>Do SDTM IG or MedDRA versions need to be considered?</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Will Harris.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
